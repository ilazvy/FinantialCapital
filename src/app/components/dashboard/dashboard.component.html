<div class="dashboard-container">
  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Welcome Section -->
    <section class="welcome-section">
      <div class="welcome-content">
        <div class="greeting">
          <h2>{{ getGreeting() }}, {{ userName }}</h2>
          <p class="role-badge">{{ getRoleDisplayName() }}</p>
        </div>
        <div class="date-time">
          <i class="fas fa-calendar-alt"></i>
          <span>{{ currentDate | date:'EEEE, d \'de\' MMMM yyyy' }}</span>
        </div>
      </div>
    </section>

    <!-- Statistics Cards -->
    <section class="stats-section">
      <div class="stats-grid">
        <div class="stat-card employees">
          <div class="stat-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-content">
            <h3>Total Empleados</h3>
            <p class="stat-number">{{ stats.totalEmployees }}</p>
            <span class="stat-change positive">
              <i class="fas fa-arrow-up"></i>
              +2 este mes
            </span>
          </div>
        </div>

        <div class="stat-card expenses">
          <div class="stat-icon">
            <i class="fas fa-minus-circle"></i>
          </div>
          <div class="stat-content">
            <h3>Gastos Totales</h3>
            <p class="stat-number">{{ formatCurrency(stats.totalExpenses) }}</p>
            <span class="stat-change negative">
              <i class="fas fa-arrow-down"></i>
              -5% vs mes anterior
            </span>
          </div>
        </div>

        <div class="stat-card income">
          <div class="stat-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          <div class="stat-content">
            <h3>Ingresos Totales</h3>
            <p class="stat-number">{{ formatCurrency(stats.totalIncome) }}</p>
            <span class="stat-change positive">
              <i class="fas fa-arrow-up"></i>
              +12% vs mes anterior
            </span>
          </div>
        </div>

        <div class="stat-card payroll">
          <div class="stat-icon">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <div class="stat-content">
            <h3>Nómina Mensual</h3>
            <p class="stat-number">{{ formatCurrency(stats.monthlyPayroll) }}</p>
            <span class="stat-change neutral">
              <i class="fas fa-minus"></i>
              Sin cambios
            </span>
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Actions -->
    <section class="actions-section">
      <h2 class="section-title">
        <i class="fas fa-bolt"></i>
        Acciones Rápidas
      </h2>
      <div class="actions-grid">
        <div 
          class="action-card" 
          *ngFor="let action of getQuickActionsForRole()"
          (click)="navigateTo(action.route)"
          [class]="'action-' + action.color"
        >
          <div class="action-icon">
            <i [class]="action.icon"></i>
          </div>
          <div class="action-content">
            <h3>{{ action.title }}</h3>
            <p>{{ action.description }}</p>
          </div>
          <div class="action-arrow">
            <i class="fas fa-chevron-right"></i>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Activities -->
    <section class="activities-section">
      <h2 class="section-title">
        <i class="fas fa-history"></i>
        Actividad Reciente
      </h2>
      <div class="activities-list">
        <div 
          class="activity-item" 
          *ngFor="let activity of recentActivities"
          [class]="'activity-' + activity.color"
        >
          <div class="activity-icon">
            <i [class]="activity.icon"></i>
          </div>
          <div class="activity-content">
            <p class="activity-message">{{ activity.message }}</p>
            <span class="activity-time">{{ activity.time }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Charts Section -->
    <section class="charts-section">
      <h2 class="section-title">
        <i class="fas fa-chart-line"></i>
        Análisis Financiero
      </h2>
      <div class="charts-grid">
        <!-- Ingresos vs Gastos -->
        <div class="chart-card">
          <h3>Ingresos vs Gastos (Últimos 6 meses)</h3>
          <div class="chart-container">
            <div class="chart-bars">
              <div class="chart-bar-group" *ngFor="let month of monthlyData; let i = index">
                <div class="month-label">{{ month.month }}</div>
                <div class="bar-container">
                  <div class="bar income-bar" [style.height.%]="getBarHeight(month.income, maxIncome)">
                    <span class="bar-value">{{ formatCurrency(month.income) }}</span>
                  </div>
                  <div class="bar expense-bar" [style.height.%]="getBarHeight(month.expenses, maxExpenses)">
                    <span class="bar-value">{{ formatCurrency(month.expenses) }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-color income"></span>
                <span>Ingresos</span>
              </div>
              <div class="legend-item">
                <span class="legend-color expense"></span>
                <span>Gastos</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Distribución de Gastos -->
        <div class="chart-card">
          <h3>Distribución de Gastos</h3>
          <div class="chart-container">
            <div class="pie-chart-container">
              <div class="pie-chart" [style.background]="getPieChartBackground()">
              </div>
              <div class="pie-legend">
                <div class="legend-item" *ngFor="let segment of expenseDistribution">
                  <span class="legend-color" [style.background]="segment.color"></span>
                  <span class="legend-text">{{ segment.label }} ({{ formatCurrency(segment.value) }})</span>
                  <span class="legend-percentage">{{ segment.percentage }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tendencia de Empleados -->
        <div class="chart-card">
          <h3>Crecimiento de Empleados</h3>
          <div class="chart-container">
            <div class="employee-growth">
              <div class="growth-item" *ngFor="let point of employeeGrowth; let i = index">
                <div class="growth-bar" [style.height.%]="(point.count / maxEmployees) * 100">
                  <span class="growth-value">{{ point.count }}</span>
                </div>
                <span class="growth-month">{{ point.month }}</span>
              </div>
            </div>
            <div class="growth-summary">
              <span class="growth-total">Total: {{ employeeGrowth[employeeGrowth.length - 1].count }} empleados</span>
              <span class="growth-change">+{{ employeeGrowth[employeeGrowth.length - 1].count - employeeGrowth[0].count }} este año</span>
            </div>
          </div>
        </div>

        <!-- Eficiencia Mensual -->
        <div class="chart-card">
          <h3>Eficiencia Mensual</h3>
          <div class="chart-container">
            <div class="efficiency-chart">
              <div class="efficiency-bar" 
                   *ngFor="let month of efficiencyData; let i = index"
                   [style.width.%]="month.efficiency">
                <div class="efficiency-label">
                  <span>{{ month.month }}</span>
                  <span>{{ month.efficiency }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Financial Summary -->
    <section class="summary-section">
      <div class="summary-grid">
        <div class="summary-card profit">
          <h3>Ganancia Neta</h3>
          <p class="summary-amount positive">
            {{ formatCurrency(stats.totalIncome - stats.totalExpenses) }}
          </p>
          <div class="summary-chart">
            <div class="chart-bar" style="width: 75%"></div>
          </div>
        </div>

        <div class="summary-card efficiency">
          <h3>Eficiencia</h3>
          <p class="summary-amount">
            {{ ((stats.totalIncome - stats.totalExpenses) / stats.totalIncome * 100).toFixed(1) }}%
          </p>
          <div class="summary-chart">
            <div class="chart-bar" style="width: 72%"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Floating Action Button -->
  <div class="fab-container">
    <button class="fab-button" (click)="navigateTo('/employee-registration')">
      <i class="fas fa-plus"></i>
    </button>
  </div>
</div>
